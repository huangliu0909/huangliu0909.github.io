<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="NUS note,DB," />










<meta name="description" content="Paper: https:&#x2F;&#x2F;www.arxiv-vanity.com&#x2F;papers&#x2F;1712.01208&#x2F;  IntroductionThere exists various data access patterns, and correspondingly various choices of index structure.B-tree: range request  (from sorte">
<meta property="og:type" content="article">
<meta property="og:title" content="Note for &quot;The Case For Learned Index Structures&quot;">
<meta property="og:url" content="https://huangliu0909.github.io/2020/09/11/Reading_Note_Learned_Index/index.html">
<meta property="og:site_name" content="Wiwi&#39;s Blog">
<meta property="og:description" content="Paper: https:&#x2F;&#x2F;www.arxiv-vanity.com&#x2F;papers&#x2F;1712.01208&#x2F;  IntroductionThere exists various data access patterns, and correspondingly various choices of index structure.B-tree: range request  (from sorte">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-1.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-2.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-2.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-3.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-4.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-5.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-6.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-7.png">
<meta property="og:image" content="https://huangliu0909.github.io/images/CS6203/index-8.png">
<meta property="article:published_time" content="2020-09-11T11:11:04.000Z">
<meta property="article:modified_time" content="2020-12-01T12:29:23.323Z">
<meta property="article:author" content="HUANG Liu">
<meta property="article:tag" content="NUS note">
<meta property="article:tag" content="DB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://huangliu0909.github.io/images/CS6203/index-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://huangliu0909.github.io/2020/09/11/Reading_Note_Learned_Index/"/>





  <title>Note for "The Case For Learned Index Structures" | Wiwi's Blog</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
  <a href="https://github.com/huangliu0909" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
   
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wiwi's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://huangliu0909.github.io/2020/09/11/Reading_Note_Learned_Index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HUANG Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wiwi's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Note for "The Case For Learned Index Structures"</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-11T19:11:04+08:00">
                2020-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Readings/" itemprop="url" rel="index">
                    <span itemprop="name">Readings</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Paper: <a href="https://www.arxiv-vanity.com/papers/1712.01208/">https://www.arxiv-vanity.com/papers/1712.01208/</a> </p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>There exists various data access patterns, and correspondingly various choices of index structure.<br>B-tree: range request  (from sorted array)<br>HashMap: single key look-ups (from unsorted array)<br>Bloom filters: check for record existence<br><a id="more"></a></p>
<p>If data is from 1 to 1000, we don’t actually need a tree structure, we just need to use a direct look-up for the key. This example shows that <strong>One size does not fit all</strong>.<br>Traditional data structures make no assumptions about data, they only rely on the size of data.<br>While using ML, we try to learn the distribution of data,  We use data complexity instead of data size to construct a suitable index. In this way, we can achieve huge performance improvement.</p>
<p>There are also many other data structures and algorithms in database system, we can apply the idea of using ML to change the design of them.</p>
<p>Basically, we want to use ML techniques to enhance traditional index structures or even replace them to get a better performance.</p>
<h1 id="Range-Index-B-tree"><a href="#Range-Index-B-tree" class="headerlink" title="Range Index (B-tree)"></a>Range Index (B-tree)</h1><h2 id="Range-Index-Models-are-CDF-Models"><a href="#Range-Index-Models-are-CDF-Models" class="headerlink" title="Range Index Models are CDF Models"></a>Range Index Models are CDF Models</h2><p>B-tree can be viewed as a model which takes the feature’s key as input and predict the position of the feature. Usually a B-tree maps a key to a page, and then searches within this page. Which means B-tree outputs a position, and searches within $[pos, pos+page_ size]$. i.e., by normal B-trees, the error is defined by the pagesize.</p>
<p>model:f(key)-&gt;pos, searches from $[pos-err_{min},pos+err_{max}]$<br>we can search in this range to find the exact right record.<br><img src="/images/CS6203/index-1.png" alt="history"></p>
<p><strong>We don’t care about generalization, we only care about the data we have.</strong></p>
<p>So B-tree is actually building a model of Cumulative Distribution Function:<br>$p=P(x\leq key)*nums_of_Keys$<br>p is the predict position from key.<br><img src="/images/CS6203/index-2.png" alt="history"><br>For example, if your data is a Gaussian Distribution, most of your data is around the middle, and the learned index can allocate more trees in that area because of this information.</p>
<p>Potantial Advantages of learned b-tree models:<br>smaller index: less main-memory storage<br>faster lookup<br>more parallelism: sequential if-statement is exchanged for multiplications</p>
<p>assume read-only</p>
<h2 id="A-First-Naive-Learned-Index"><a href="#A-First-Naive-Learned-Index" class="headerlink" title="A First Naive Learned Index"></a>A First Naive Learned Index</h2><p>200 M records of timestamps (sorted)<br>two-layer fully-connected neural network<br>32 neurons per layer<br>ReLu activation functions<br>train this model to predict the position of the timestamp<br>measure the look-up time for a randomly selected key (averaged over several runs)</p>
<p>look-up with B-tree: 300ns<br>look-up with binary search: 900ns<br>look-up with Model: 80000ns (1250 predictions per second)</p>
<p>This model is a naive version and doesn’t work well and we find this model is limited in the following ways:</p>
<ol>
<li>Tensorflow is designed for large models, not small models like this.</li>
<li>B-tree can easily overfit the training data and can predict the position precisely. For database system, overfitting is not that bad, you get a database, you know the data you’re trying to search, and there are no other data outside to generalize,<br>While learned index can easily narrow the space from 100M to 10k but have trouble in narrowing the space from 100M to hundreds, which is “the last mile of learned index”, in other words, learned index has problems being accurate at the individual data instance level.</li>
<li>B-trees are cache efficient, they keep the top nodes always in cache and they access other pages if needed. In contrast NN need to load the all parameters into memory to compute a prediction and have a high cost in the number of multiplications.</li>
<li>For classic machine learning problems, the ultimate goal is the desired average average error, but we look for the index, hoping to get the best prediction, and finally hoping to find the true position of the key. Search does not make advantage of this prediction, the question is what is the right search style given an approximate answer</li>
</ol>
<h1 id="RM-Index-B-tree"><a href="#RM-Index-B-tree" class="headerlink" title="RM-Index (B-tree)"></a>RM-Index (B-tree)</h1><h2 id="The-Learning-Index-Framework-LIF"><a href="#The-Learning-Index-Framework-LIF" class="headerlink" title="The Learning Index Framework (LIF)"></a>The Learning Index Framework (LIF)</h2><p>LIF is an index optimization system. Given a set of index data, LIF automatically generates multiple sets of hyperparameters, and automatically optimizes and tests to find the optimal set of configurations.<br>When applied in a real database, LIF will generate an efficient index structure based on C++. LIF focuses on small models, so many unnecessary costs for managing large models must be reduced(Use a specific model structure to reduce runtime overhead, such as pruning, removing redundant if-else, direct memory access, etc.), now we can optimize the model prediction to within 30ns.<br><em>LIF is still an experimental framework and is instumentalized to quickly evaluate different index configurations.</em></p>
<h2 id="Recursive-Model-Index"><a href="#Recursive-Model-Index" class="headerlink" title="Recursive Model Index"></a>Recursive Model Index</h2><p>The real data distribution function is often between the two: in general, it satisfies a change trend, but the part is a piecewise function (the piecewise function of daily data may be different)<br><img src="/images/CS6203/index-2.png" alt="history"></p>
<p>In that case we use the idea of Mixture-of-Experts and propose Recursive Model Index to solve the problem of “the last mile of learned index”</p>
<p>We use a hierarchical experts, i.e. a hierarchy of models.<br>At each stage, take the key as input and based on it to pick another model, until final stage predicts the position.</p>
<p>Every model is like an expert for a certain range and may has a better prediction.</p>
<ul>
<li>Such a multi-layer model structure is not a search tree, and multiple stage 2 models may point to the same stage 3 model. In addition, at the lowest level, in order to ensure that the smallest and largest deviations can be controlled, we can also use B-Tree to complete the final index.</li>
<li>Each model does not need to cover the same amount of records like B-trees do.</li>
<li>predictions between stages don’t need to be the estimate of position, but can be considered as picking an expert which has a better knowledge about certain keys.</li>
</ul>
<p><img src="/images/CS6203/index-3.png" alt="history"><br>RMI has several benefits:</p>
<ol>
<li>It separates model size and complexity from execution cost</li>
<li>It is easy to learn the overall data distribution</li>
<li>Divide the entire space into smaller subranges. Each subranges is similar to a B-tree or decision tree, making it easier to solve the last-mile accuracy problem.</li>
<li>No search process is required in-between stages. For example, the output y of model 1.1 is an offset, which can be directly used to select the model of the next stage.</li>
</ol>
<h2 id="Hybrid-Indexes"><a href="#Hybrid-Indexes" class="headerlink" title="Hybrid Indexes"></a>Hybrid Indexes</h2><p>Another advantage of the recursive model index is that we are able to build mixtures of models.<br>top-layer: a small ReLU neural net —- they can learn a wide range of  complex data<br>bottom: simple models like linear regression(inexpensive in space and execution), or B-trees if the data is particularly hard to learn(worst case)</p>
<p>Such a recursive model has several advantages: </p>
<ol>
<li>It can learn the shape of the output data well. </li>
<li>Through stratification, you can basically use B-Tree or decision tree to obtain very high search efficiency. </li>
<li>Different stages can use penetration to initialize the model instead of searching, which makes it easier to refactor and optimize the programming language.</li>
</ol>
<h2 id="Search-Strategy"><a href="#Search-Strategy" class="headerlink" title="Search Strategy"></a>Search Strategy</h2><ol>
<li>Model Biased Search：the default search strategy, based on binary search, the new intermediate point is based on the standard deviation $\sigma$ of the last layer of model settings</li>
<li>Biased Quaternary Search：search three points at the same time, $pos-\sigma, pos, pos+\sigma$ . Requires CPU to obtain multiple data addresses in parallel from main memory</li>
</ol>
<ul>
<li>how to deal with large address spaces</li>
<li>how do we deal with not able to assume that the end location is ordered<br>if pages are in disks or other seperate devices they may not be in order<br>it’s an engineering issue</li>
</ul>
<h2 id="Indexing-Strings"><a href="#Indexing-Strings" class="headerlink" title="Indexing Strings"></a>Indexing Strings</h2><h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p>trade-off between memory and latency</p>
<p>Map data: relatively linear<br>Web data: (timestamp) complex, a worst case<br>Log Normal Data: non-linear integers, heavy tail<br>2nd stage: linear models have the best performance.<br>For the last mile we don’t need to execute complex models.</p>
<p><img src="/images/CS6203/index-4.png" alt="history"></p>
<ul>
<li>Histogram: B-Trees approximate the CDF of the underlying data distribution. When we use  histograms as a CDF,this histogram must be a low error approximation of the CDF. However,  this requires a large number of buckets, which makes it expensive to search the histogram itself. And almost every bucket has data insides, only few buckets are empty or too full. The solution to this case is B-Trees, so we’ll not discuss Histogram individually.</li>
<li>Lookup-Table: Lookup-table is another simple alternative to B-trees. A lookup table is an array that replaces runtime computation with a simpler array indexing operation(Wikipedia).<blockquote>
<p>Performance comparison: linear search vs binary search.<br><a href="https://dirtyhandscoding.wordpress.com/2017/08/25/performance-comparison-linear-search-vs-binary-search/">https://dirtyhandscoding.wordpress.com/2017/08/25/performance-comparison-linear-search-vs-binary-search/</a></p>
</blockquote>
</li>
<li>FAST: a highly SIMD optimized data structure, allocate memory in the power of 2, leading to significantly larger indexes</li>
<li>Fixed-size B-Tree &amp; interpolation search</li>
<li>Learned indexes without overhead: a multivariate linear regression model at the top and simple linear models at bottom<br><img src="/images/CS6203/index-5.png" alt="history"></li>
</ul>
<p>Because the binary search of string will be more time-consuming, the search strategy proposed above(learned QS with quaternary search) can improve efficiency more significantly<br><img src="/images/CS6203/index-6.png" alt="history"></p>
<h1 id="Point-Index-hash"><a href="#Point-Index-hash" class="headerlink" title="Point Index (hash)"></a>Point Index (hash)</h1><p>Point Index, as the name suggests, is to search for the position corresponding to the key, which is Hashmap. Hashmap is naturally a model, the input is the key and the output is the position. For Hashmap, in order to reduce conflicts, it is often necessary to use a much larger number of slots than the number of keys (the paper mentions that a hashmap usually has 78% extra slots in Google). For conflicts, although there are linked-list or secondary probing methods to deal with, their overhead is not small. Even using sparse-hashmap to optimize memory usage, the performance is 3-7 times slower than hashmap. </p>
<p>Therefore,  the learned model can reduce the additional memory overhead on the one hand, and reduce the overhead of some conflicts on the other hand (Hashmap can avoid conflicts by using more slots. If there are few conflicts, it will be difficult to optimize the index Time Because Hashmap is inherently constant complexity, the goal here is to reduce the memory overhead of Hashmap while ensuring indexing time). As shown in the figure below, the Learned Hashmap can not only reduce conflicts, but also make better use of memory space under the same number of slots.</p>
<p>The point index does not need to ensure that the records are continuous (maxerr and minerr do not need to be considered), so the trained model F fit CDF is easier to meet<br><img src="/images/CS6203/index-7.png" alt="history"><br>After the hash function is replaced with the model, the index time is not shortened, but the key space is indeed effectively reduced, which improves the space utilization<br><img src="/images/CS6203/index-8.png" alt="history"></p>
<h1 id="Existence-Index-Bloom-Filters"><a href="#Existence-Index-Bloom-Filters" class="headerlink" title="Existence Index (Bloom-Filters)"></a>Existence Index (Bloom-Filters)</h1><p>Although Bloom filters allow false positives,<br>for many applications the space savings outweigh this drawback</p>
<p>Considering the usage scenario of the existence index is usually to first determine whether the record exists in the cold storage, and then access the data through disk or network. So the latency can be relatively high, so that we can use more complex RNN or CNN models as classifiers.</p>
<h1 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h1><h2 id="B-Tree-and-Variants"><a href="#B-Tree-and-Variants" class="headerlink" title="B-Tree and Variants"></a>B-Tree and Variants</h2><p>Over the last few years, a variety of different index structures have been proposed, such as B+-trees, red-black trees, all aiming at improving the performance of original main-memory trees. However, none of the structures have learned from the data distribution.</p>
<p>While using our hybrid model, we can combine the existing index structures with the learned index for further performance gains.</p>
<h2 id="Perfect-hashing"><a href="#Perfect-hashing" class="headerlink" title="Perfect hashing"></a>Perfect hashing</h2><p>Perfect hashing tried to avoid conflicts without learning techniques.<br>The size of perfect hash function relies on data size.<br>In contrast, Learned hash function can be indenpendent of data size.<br>What’s more, perfect hash is not suitable for B-trees and Bloom filters.</p>
<h2 id="Bloom-filters"><a href="#Bloom-filters" class="headerlink" title="Bloom filters"></a>Bloom filters</h2><p>Our existence indexes directly make use of the current bloom filters by adding a ML model before the simple bloom filter and creating a classification model.<br>And in addition we can also use our learning model as a special hash function to seperate the keys and non-keys.</p>
<h2 id="Modeling-CDFs"><a href="#Modeling-CDFs" class="headerlink" title="Modeling CDFs"></a>Modeling CDFs</h2><p>Our models for both range and point indexes are closely tied to models of CDF.<br>How to mostly model CDF remanins an open question.</p>
<h2 id="Mixture-of-Experts"><a href="#Mixture-of-Experts" class="headerlink" title="Mixture of Experts"></a>Mixture of Experts</h2><p>Our RMI architecture builds experts for subsets of the data and in this way we can make our model size indepentent on model computation.<br>So we can create models that are complex but still cheap to execute.</p>
<h1 id="Conclusion-and-future-work"><a href="#Conclusion-and-future-work" class="headerlink" title="Conclusion and future work"></a>Conclusion and future work</h1><h2 id="Other-ML-Models"><a href="#Other-ML-Models" class="headerlink" title="Other ML Models"></a>Other ML Models</h2><p>We combine some simple neural networks with the existing data structures, and there are definitely more ways to do the combination which are worth exploring.</p>
<h2 id="Multi-Dimensional-Indexes"><a href="#Multi-Dimensional-Indexes" class="headerlink" title="Multi-Dimensional Indexes"></a>Multi-Dimensional Indexes</h2><p>Models like NN are extremely good at handling multi-dimensional data, and the learned model could be used to estimate the position given various attributes.</p>
<h2 id="Learned-Algorithms-beyond-indexing"><a href="#Learned-Algorithms-beyond-indexing" class="headerlink" title="Learned Algorithms beyond indexing"></a>Learned Algorithms beyond indexing</h2><p>Learned Algorithms can also be applied to other data structures and CDF models are beneficial to join and sorting operations as well.</p>
<h2 id="GPU-TPU"><a href="#GPU-TPU" class="headerlink" title="GPU/TPU"></a>GPU/TPU</h2><p>All we have been doing is to learn data pattern and use it in data structure design.<br>We are now having TPU/GPU which are vector processors and vector multiplies become very cheap.<br>We can make use of this property and construct new data structure along with ML techniques to speed up the look-up time and get better performance.</p>
<p><strong>In summary, we have demonstrated that machine learned models have the potential to provide significant benefits over state-of-the-art indexes, and we believe this is a fruitful direction for future research.</strong></p>
<blockquote>
<p>B-tree indexes and CPU caches<br><a href="https://www.researchgate.net/search.Search.html?type=publication&amp;query=%20B-tree%20indexes%20and%20CPU%20caches">https://www.researchgate.net/search.Search.html?type=publication&amp;query=%20B-tree%20indexes%20and%20CPU%20caches</a><br>Making B+-Trees Cache Conscious in Main Memory<br><a href="http://www.cse.iitb.ac.in/infolab/Data/Courses/CS632/2006/Papers/cache-b-tree.pdf">http://www.cse.iitb.ac.in/infolab/Data/Courses/CS632/2006/Papers/cache-b-tree.pdf</a><br>Adaptive Range Filters for Cold Data: Avoiding Trips to Siberia<br><a href="http://www.vldb.org/pvldb/vol6/p1714-kossmann.pdf">http://www.vldb.org/pvldb/vol6/p1714-kossmann.pdf</a><br>Cuckoo Filter: Practically Better Than Bloom<br><a href="https://www.cs.cmu.edu/~dga/papers/cuckoo-conext2014.pdf">https://www.cs.cmu.edu/~dga/papers/cuckoo-conext2014.pdf</a></p>
</blockquote>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    HUANG Liu
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="https://huangliu0909.github.io/2020/09/11/Reading_Note_Learned_Index/" title="Note for "The Case For Learned Index Structures"">https://huangliu0909.github.io/2020/09/11/Reading_Note_Learned_Index/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/NUS-note/" rel="tag"># NUS note</a>
          
            <a href="/tags/DB/" rel="tag"># DB</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/09/09/CS5340%20Lec05/" rel="next" title="Factor Graph and the Junction Tree Algorithm">
                <i class="fa fa-chevron-left"></i> Factor Graph and the Junction Tree Algorithm
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/09/11/Reading_ppt_Learned_Index/" rel="prev" title="PPT for "The Case For Learned Index Structures"">
                PPT for "The Case For Learned Index Structures" <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">HUANG Liu</p>
              <p class="site-description motion-element" itemprop="description">Love always wins.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/huangliu0909" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="wiwillow.99@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Range-Index-B-tree"><span class="nav-number">2.</span> <span class="nav-text">Range Index (B-tree)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Range-Index-Models-are-CDF-Models"><span class="nav-number">2.1.</span> <span class="nav-text">Range Index Models are CDF Models</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#A-First-Naive-Learned-Index"><span class="nav-number">2.2.</span> <span class="nav-text">A First Naive Learned Index</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RM-Index-B-tree"><span class="nav-number">3.</span> <span class="nav-text">RM-Index (B-tree)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Learning-Index-Framework-LIF"><span class="nav-number">3.1.</span> <span class="nav-text">The Learning Index Framework (LIF)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Recursive-Model-Index"><span class="nav-number">3.2.</span> <span class="nav-text">Recursive Model Index</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hybrid-Indexes"><span class="nav-number">3.3.</span> <span class="nav-text">Hybrid Indexes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Search-Strategy"><span class="nav-number">3.4.</span> <span class="nav-text">Search Strategy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Indexing-Strings"><span class="nav-number">3.5.</span> <span class="nav-text">Indexing Strings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Training"><span class="nav-number">3.6.</span> <span class="nav-text">Training</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Results"><span class="nav-number">3.7.</span> <span class="nav-text">Results</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Point-Index-hash"><span class="nav-number">4.</span> <span class="nav-text">Point Index (hash)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Existence-Index-Bloom-Filters"><span class="nav-number">5.</span> <span class="nav-text">Existence Index (Bloom-Filters)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Related-Work"><span class="nav-number">6.</span> <span class="nav-text">Related Work</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#B-Tree-and-Variants"><span class="nav-number">6.1.</span> <span class="nav-text">B-Tree and Variants</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Perfect-hashing"><span class="nav-number">6.2.</span> <span class="nav-text">Perfect hashing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bloom-filters"><span class="nav-number">6.3.</span> <span class="nav-text">Bloom filters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modeling-CDFs"><span class="nav-number">6.4.</span> <span class="nav-text">Modeling CDFs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mixture-of-Experts"><span class="nav-number">6.5.</span> <span class="nav-text">Mixture of Experts</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion-and-future-work"><span class="nav-number">7.</span> <span class="nav-text">Conclusion and future work</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-ML-Models"><span class="nav-number">7.1.</span> <span class="nav-text">Other ML Models</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multi-Dimensional-Indexes"><span class="nav-number">7.2.</span> <span class="nav-text">Multi-Dimensional Indexes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Learned-Algorithms-beyond-indexing"><span class="nav-number">7.3.</span> <span class="nav-text">Learned Algorithms beyond indexing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GPU-TPU"><span class="nav-number">7.4.</span> <span class="nav-text">GPU&#x2F;TPU</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HUANG Liu</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">62.8k</span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
